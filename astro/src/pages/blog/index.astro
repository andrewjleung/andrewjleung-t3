---
import Layout from "@/layouts/Layout.astro";
import { ArrowRight } from "lucide-react";
import { getCollection } from "astro:content";
import { compareDesc, formatDistanceToNowStrict } from "date-fns";

const blogPosts = (await getCollection("blog"))
    .filter((post) => post.data.live)
    .sort(
        (a, b) =>
            compareDesc(a.data.publishDate, b.data.publishDate) ||
            a.data.title.localeCompare(b.data.title),
    )
    .map((post) => ({
        ...post,
        data: {
            ...post.data,
            formattedDate: formatDistanceToNowStrict(post.data.publishDate, {
                addSuffix: true,
            }),
        },
    }));
---

<Layout title="Andrew Leung â€“ Blog" pageTitle="Blog" showHeader>
    <section class="flex flex-col gap-5">
        {blogPosts.map(post => (
            <a
                href={`/blog/${post.id}`}
                class="grid sm:grid-cols-6 grid-cols-1 relative group ease-out duration-200 sm:hover:translate-x-2 border-t pt-2 animate-fade-in-up-1"
            >
                <div
                    class="absolute right-full mr-4 pt-2 opacity-0 group-hover:opacity-100 duration-100 ease-in-out hidden sm:block"
                >
                    <ArrowRight
                        className="stroke-2 scale-75 stroke-foreground"
                    />
                </div>

                <div class="sm:col-span-1 flex flex-col">
                    <h3 class="sm:text-lg text-2xl">{post.data.title}</h3>
                </div>

                <div class="sm:col-span-5 pt-2 sm:pt-0.5 text-lg line-clamp-3 sm:line-clamp-none">
                    <p class="">
                        {post.data.description}
                    </p>
                </div>
            </a>
            ))}
    </section>
</Layout>
